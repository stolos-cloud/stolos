# GCP Talos Node: {{.Name}}
# Managed by Stolos - Generated at {{.Timestamp}}
# Talos config stored in GCS bucket

# Fetch Talos machine configuration from GCS storage
data "google_storage_bucket_object_content" "{{.Name}}_config" {
  name   = "talos-configs/{{.Name}}.yaml"
  bucket = "{{.BucketName}}"
}

module "{{.Name}}" {
  source = "../../modules/node"

  name         = "{{.Name}}"
  machine_type = "{{.MachineType}}"
  zone         = "{{.Zone}}"
  region       = "{{.Region}}"
  role         = "{{.Role}}"
  architecture = "{{.Architecture}}"

  talos_config = data.google_storage_bucket_object_content.{{.Name}}_config.content

  # Network configuration
  network_name    = "{{.ClusterName}}-vpc"
  subnetwork_name = "{{.ClusterName}}-subnet"

  disk_size_gb = {{.DiskSizeGB}}
  disk_type    = "{{.DiskType}}"
}

output "{{.Name}}_info" {
  value = {
    instance_id   = module.{{.Name}}.instance_id
    instance_name = module.{{.Name}}.instance_name
    internal_ip   = module.{{.Name}}.internal_ip
    external_ip   = module.{{.Name}}.external_ip
    zone          = module.{{.Name}}.zone
    status        = module.{{.Name}}.status
  }
  description = "Node information for {{.Name}}"
}